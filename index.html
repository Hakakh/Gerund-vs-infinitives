
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Tr√≤ ch∆°i h·ªçc ti·∫øng Anh: Gerund v√† Infinitive d√†nh cho h·ªçc sinh l·ªõp 7." />
    <title>H·ªçc Ng·ªØ Ph√°p: Gerund & Infinitive</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Nunito', sans-serif;
        background-color: #f8fafc;
        overflow-x: hidden;
      }
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-6px); }
        75% { transform: translateX(6px); }
      }
      .animate-shake {
        animation: shake 0.4s ease-in-out;
      }
      .fade-in {
        animation: fadeIn 0.4s ease-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .progress-bar-fill {
        transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .word-btn {
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      .word-btn:active {
        transform: scale(0.95);
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useCallback, useMemo, useRef, useEffect } = React;

      // --- D·ªØ li·ªáu b√†i h·ªçc ---
      const topics = {
        "ƒê·ªông t·ª´ ƒëi k√®m 'to V'": [
            { en: "I want to come to the party.", vi: "T·ªõ mu·ªën ƒë·∫øn b·ªØa ti·ªác. ü•≥" },
            { en: "We decided to go out for dinner.", vi: "Ch√∫ng t·ªõ ƒë√£ quy·∫øt ƒë·ªãnh ra ngo√†i ƒÉn t·ªëi. üçΩÔ∏è" },
            { en: "I hope to pass the exam.", vi: "T·ªõ hy v·ªçng s·∫Ω thi ƒë·∫≠u. üéì" },
            { en: "She plans to buy a new flat next year.", vi: "C√¥ ·∫•y d·ª± ƒë·ªãnh mua m·ªôt cƒÉn h·ªô m·ªõi v√†o nƒÉm sau. üè†" },
            { en: "They are learning to sing.", vi: "H·ªç ƒëang h·ªçc h√°t. üé§" },
            { en: "We promised not to be late.", vi: "Ch√∫ng t·ªõ h·ª©a s·∫Ω kh√¥ng ƒë·∫øn mu·ªôn. ‚è∞" },
            { en: "We agree to start early.", vi: "Ch√∫ng t·ªõ ƒë·ªìng √Ω xu·∫•t ph√°t s·ªõm. ‚òÄÔ∏è" },
            { en: "I need to go to school today.", vi: "H√¥m nay t·ªõ c·∫ßn ƒë·∫øn tr∆∞·ªùng. üè´" },
            { en: "I tried to pass the exam.", vi: "T·ªõ ƒë√£ c·ªë g·∫Øng v∆∞·ª£t qua k·ª≥ thi. üí™" },
            { en: "I would like to see her tonight.", vi: "T·ªõ mu·ªën g·∫∑p c√¥ ·∫•y t·ªëi nay. ‚ú®" },
            { en: "He offered to help me with my homework.", vi: "C·∫≠u ·∫•y ƒë·ªÅ ngh·ªã gi√∫p t·ªõ l√†m b√†i t·∫≠p v·ªÅ nh√†. üìö" },
            { en: "She refused to answer the question.", vi: "C√¥ ·∫•y t·ª´ ch·ªëi tr·∫£ l·ªùi c√¢u h·ªèi. ü§ê" },
            { en: "I expect to see you there.", vi: "T·ªõ mong s·∫Ω g·∫∑p c·∫≠u ·ªü ƒë√≥. üëã" },
            { en: "He managed to open the door.", vi: "Anh ·∫•y ƒë√£ xoay x·ªü m·ªü ƒë∆∞·ª£c c√°i c·ª≠a. üö™" },
            { en: "I can't afford to buy that bike.", vi: "T·ªõ kh√¥ng ƒë·ªß ti·ªÅn mua chi·∫øc xe ƒë·∫°p ƒë√≥. üö≤" },
            { en: "She seems to be tired.", vi: "C√¥ ·∫•y d∆∞·ªùng nh∆∞ ƒëang m·ªát. üò¥" },
            { en: "They arranged to meet at five p.m.", vi: "H·ªç ƒë√£ s·∫Øp x·∫øp g·∫∑p nhau l√∫c 5 gi·ªù chi·ªÅu. üïî" },
            { en: "I am happy to hear that news.", vi: "T·ªõ r·∫•t vui khi nghe tin ƒë√≥. üòä" },
            { en: "It is easy to learn English.", vi: "H·ªçc ti·∫øng Anh r·∫•t d·ªÖ. üî§" },
            { en: "She was surprised to see him.", vi: "C√¥ ·∫•y ng·∫°c nhi√™n khi th·∫•y anh ·∫•y. üò≤" },
            { en: "My dad taught me how to ride a bike.", vi: "B·ªë d·∫°y t·ªõ c√°ch ƒëi xe ƒë·∫°p. üö≤" }
        ],
        "C·∫•u tr√∫c 'Object + to V'": [
            { en: "I asked him to leave early.", vi: "T·ªõ ƒë√£ b·∫£o c·∫≠u ·∫•y v·ªÅ s·ªõm. üè†" },
            { en: "My mother told me to clean my room.", vi: "M·∫π b·∫£o t·ªõ d·ªçn ph√≤ng. üßπ" },
            { en: "He advised me to apply at once.", vi: "Ch√∫ ·∫•y khuy√™n t·ªõ n·ªôp ƒë∆°n ngay l·∫≠p t·ª©c. üìù" },
            { en: "She allowed me to use her car.", vi: "C√¥ ·∫•y cho ph√©p t·ªõ d√πng xe c·ªßa c√¥ ·∫•y. üöó" },
            { en: "I want him to come to the party.", vi: "T·ªõ mu·ªën c·∫≠u ·∫•y ƒë·∫øn b·ªØa ti·ªác. üéâ" },
            { en: "They invited us to stay for dinner.", vi: "H·ªç m·ªùi ch√∫ng t·ªõ ·ªü l·∫°i ƒÉn t·ªëi. üçó" },
            { en: "Please remind me to buy milk.", vi: "L√†m ∆°n nh·∫Øc t·ªõ mua s·ªØa nh√©. ü•õ" },
            { en: "The teacher encouraged us to study hard.", vi: "Gi√°o vi√™n khuy·∫øn kh√≠ch ch√∫ng t·ªõ h·ªçc chƒÉm ch·ªâ. ‚úçÔ∏è" }
        ],
        "ƒê·ªông t·ª´ nguy√™n m·∫´u (Bare V)": [
            { en: "She can speak English very well.", vi: "C√¥ ·∫•y c√≥ th·ªÉ n√≥i ti·∫øng Anh r·∫•t t·ªët. üó£Ô∏è" },
            { en: "You must try the new restaurant.", vi: "B·∫°n ph·∫£i th·ª≠ nh√† h√†ng m·ªõi ƒë√≥ nh√©. üçî" },
            { en: "I must go now.", vi: "T·ªõ ph·∫£i ƒëi ngay b√¢y gi·ªù. üèÉ" },
            { en: "You really should study more.", vi: "C·∫≠u th·ª±c s·ª± n√™n h·ªçc b√†i nhi·ªÅu h∆°n. üìñ" },
            { en: "They will be late.", vi: "H·ªç s·∫Ω b·ªã mu·ªôn ƒë·∫•y. ‚è≥" },
            { en: "It may rain at the weekend.", vi: "Cu·ªëi tu·∫ßn tr·ªùi c√≥ th·ªÉ s·∫Ω m∆∞a. üåßÔ∏è" },
            { en: "We could go to the cinema.", vi: "Ch√∫ng ta c√≥ th·ªÉ ƒëi xem phim. üé¨" },
            { en: "My dad lets me drive his car.", vi: "B·ªë cho ph√©p t·ªõ l√°i xe c·ªßa b·ªë. üèéÔ∏è" },
            { en: "Let's go.", vi: "Ch√∫ng ta ƒëi th√¥i n√†o. üöÄ" },
            { en: "The teacher made us write an essay.", vi: "Gi√°o vi√™n b·∫Øt ch√∫ng t·ªõ vi·∫øt m·ªôt b√†i ti·ªÉu lu·∫≠n. üìÑ" },
            { en: "The music made him want to dance.", vi: "√Çm nh·∫°c khi·∫øn anh ·∫•y mu·ªën nh·∫£y m√∫a. üíÉ" },
            { en: "Have Mrs Hansen come in please.", vi: "L√†m ∆°n m·ªùi b√† Hansen v√†o. üö™" },
            { en: "I saw her cross the road.", vi: "T·ªõ ƒë√£ nh√¨n th·∫•y c√¥ ·∫•y bƒÉng qua ƒë∆∞·ªùng. üõ£Ô∏è" },
            { en: "We saw him leave the house.", vi: "Ch√∫ng t·ªõ th·∫•y anh ·∫•y r·ªùi kh·ªèi nh√†. üè†" },
            { en: "She heard the baby cry in the next room.", vi: "C√¥ ·∫•y nghe th·∫•y em b√© kh√≥c ·ªü ph√≤ng b√™n. üë∂" },
            { en: "I watch them do gardening all afternoon.", vi: "T·ªõ quan s√°t h·ªç l√†m v∆∞·ªùn c·∫£ bu·ªïi chi·ªÅu. üåª" },
            { en: "He helped me wash my car.", vi: "Anh ·∫•y ƒë√£ gi√∫p t·ªõ r·ª≠a xe. üßΩ" },
            { en: "You had better work.", vi: "T·ªët h∆°n h·∫øt l√† c·∫≠u n√™n l√†m vi·ªác ƒëi. üí™" },
            { en: "We would rather work than play.", vi: "Ch√∫ng t·ªõ th√† l√†m vi·ªác c√≤n h∆°n l√† ch∆°i. üõ†Ô∏è" },
            { en: "Why not take a holiday?", vi: "Sao kh√¥ng ƒëi ngh·ªâ m√°t ƒëi nh·ªâ? üèñÔ∏è" }
        ],
        "Danh ƒë·ªông t·ª´ (V-ing)": [
            { en: "I enjoy reading books in the library.", vi: "T·ªõ th√≠ch ƒë·ªçc s√°ch trong th∆∞ vi·ªán. üìö" },
            { en: "Have you finished doing your homework?", vi: "C·∫≠u ƒë√£ l√†m xong b√†i t·∫≠p v·ªÅ nh√† ch∆∞a? ‚úÖ" },
            { en: "She practices speaking English every day.", vi: "C√¥ ·∫•y luy·ªán n√≥i ti·∫øng Anh m·ªói ng√†y. üó£Ô∏è" },
            { en: "We should avoid eating too much sugar.", vi: "Ch√∫ng ta n√™n tr√°nh ƒÉn qu√° nhi·ªÅu ƒë∆∞·ªùng. üç¨" },
            { en: "Do you mind opening the window?", vi: "B·∫°n c√≥ phi·ªÅn m·ªü gi√∫p t·ªõ c√°i c·ª≠a s·ªï kh√¥ng? ü™ü" },
            { en: "He suggested going to the cinema.", vi: "C·∫≠u ·∫•y ƒë·ªÅ ngh·ªã ƒëi xem phim. üìΩÔ∏è" },
            { en: "He kept working although he was tired.", vi: "Anh ·∫•y v·∫´n ti·∫øp t·ª•c l√†m vi·ªác d√π ƒë√£ m·ªát. üèóÔ∏è" },
            { en: "I dislike waiting for buses.", vi: "T·ªõ kh√¥ng th√≠ch vi·ªác ph·∫£i ch·ªù xe bu√Ωt. üöå" },
            { en: "I miss playing with my old friends.", vi: "T·ªõ nh·ªõ nh·ªØng l·∫ßn ch∆°i ƒë√πa c√πng b·∫°n c≈©. üßë‚Äçü§ù‚Äçüßë" },
            { en: "He denied breaking the vase.", vi: "C·∫≠u ·∫•y ph·ªß nh·∫≠n vi·ªác l√†m v·ª° b√¨nh hoa. üè∫" },
            { en: "I like watching TV.", vi: "T·ªõ th√≠ch xem TV. üì∫" },
            { en: "She loves swimming in the summer.", vi: "C√¥ ·∫•y y√™u th√≠ch b∆°i l·ªôi v√†o m√πa h√®. üèä" },
            { en: "He hates getting up early.", vi: "C·∫≠u ·∫•y gh√©t ph·∫£i d·∫≠y s·ªõm. üò¥" },
            { en: "I prefer driving to traveling by train.", vi: "T·ªõ th√≠ch l√°i xe h∆°n l√† ƒëi t√†u h·ªèa. üöó" },
            { en: "I look forward to meeting you.", vi: "T·ªõ r·∫•t mong ƒë∆∞·ª£c g·∫∑p c·∫≠u. üëã" },
            { en: "I am used to getting up early.", vi: "T·ªõ ƒë√£ quen v·ªõi vi·ªác d·∫≠y s·ªõm r·ªìi. ‚òÄÔ∏è" },
            { en: "I can't stand waiting in the rain.", vi: "T·ªõ kh√¥ng th·ªÉ ch·ªãu ƒë·ª±ng ƒë∆∞·ª£c vi·ªác ch·ªù ƒë·ª£i d∆∞·ªõi m∆∞a. üåßÔ∏è" },
            { en: "My mom is busy cooking dinner.", vi: "M·∫π t·ªõ ƒëang b·∫≠n n·∫•u b·ªØa t·ªëi. üç≥" },
            { en: "It is no use worrying about it.", vi: "Lo l·∫Øng v·ªÅ vi·ªác ƒë√≥ c≈©ng v√¥ √≠ch th√¥i. üòü" },
            { en: "Let's go shopping.", vi: "Ch√∫ng m√¨nh ƒëi mua s·∫Øm ƒëi. üõçÔ∏è" },
            { en: "They go swimming every Sunday.", vi: "H·ªç ƒëi b∆°i v√†o m·ªói Ch·ªß nh·∫≠t. üèä‚Äç‚ôÇÔ∏è" },
            { en: "He is good at playing football.", vi: "C·∫≠u ·∫•y gi·ªèi ch∆°i b√≥ng ƒë√°. ‚öΩ" },
            { en: "Thank you for helping me.", vi: "C·∫£m ∆°n v√¨ ƒë√£ gi√∫p t·ªõ. ‚ù§Ô∏è" },
            { en: "She left without saying goodbye.", vi: "C√¥ ·∫•y r·ªùi ƒëi m√† kh√¥ng ch√†o t·∫°m bi·ªát. üëã" }
        ],
        "ƒê·ªông t·ª´ thay ƒë·ªïi nghƒ©a": [
            { en: "Please stop talking.", vi: "L√†m ∆°n ng·ª´ng n√≥i chuy·ªán ƒëi (d·ª´ng h·∫≥n). ü§´" },
            { en: "I stopped to buy a newspaper.", vi: "T·ªõ d·ª´ng l·∫°i ƒë·ªÉ mua b√°o (m·ª•c ƒë√≠ch). üì∞" },
            { en: "I remember meeting him somewhere.", vi: "T·ªõ nh·ªõ l√† ƒë√£ g·∫∑p anh ·∫•y ·ªü ƒë√¢u ƒë√≥ r·ªìi (qu√° kh·ª©). ü§î" },
            { en: "Remember to lock the door.", vi: "Nh·ªõ ph·∫£i kh√≥a c·ª≠a nh√© (ch∆∞a l√†m). üîê" },
            { en: "I will never forget visiting Paris.", vi: "T·ªõ s·∫Ω kh√¥ng bao gi·ªù qu√™n l·∫ßn ƒëi thƒÉm Paris. üóº" },
            { en: "Don't forget to buy milk.", vi: "ƒê·ª´ng qu√™n ph·∫£i mua s·ªØa ƒë·∫•y. ü•õ" },
            { en: "You should try eating this cake.", vi: "C·∫≠u n√™n th·ª≠ ƒÉn c√°i b√°nh n√†y xem (th·ª≠ nghi·ªám). üç∞" },
            { en: "I tried to open the jar but it was tight.", vi: "T·ªõ ƒë√£ c·ªë g·∫Øng m·ªü c√°i l·ªç nh∆∞ng n√≥ ch·∫∑t qu√°. üçØ" },
            { en: "He regrets leaving school early.", vi: "Anh ·∫•y h·ªëi h·∫≠n v√¨ ƒë√£ b·ªè h·ªçc s·ªõm. üòî" },
            { en: "I regret to tell you that you failed.", vi: "T√¥i l·∫•y l√†m ti·∫øc ph·∫£i th√¥ng b√°o r·∫±ng b·∫°n ƒë√£ tr∆∞·ª£t. üìâ" },
            { en: "You need to work harder.", vi: "C·∫≠u c·∫ßn l√†m vi·ªác chƒÉm h∆°n. üí™" },
            { en: "This house needs painting.", vi: "Ng√¥i nh√† n√†y c·∫ßn ƒë∆∞·ª£c s∆°n l·∫°i (b·ªã ƒë·ªông). üè†" },
            { en: "I saw him steal the bike.", vi: "T·ªõ th·∫•y anh ta tr·ªôm xe (to√†n b·ªô qu√° tr√¨nh). üö≤" },
            { en: "I saw him waiting for the bus.", vi: "T·ªõ th·∫•y anh ·∫•y ƒëang ch·ªù xe bu√Ωt (m·ªôt ph·∫ßn h√†nh ƒë·ªông). üöå" }
        ]
      };

      const Fireworks = () => {
        const canvasRef = useRef(null);
        useEffect(() => {
          const canvas = canvasRef.current;
          const ctx = canvas.getContext('2d');
          let particles = [];
          let animationId;
          const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
          window.addEventListener('resize', resize);
          resize();
          const loop = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
              p.x += p.vx; p.y += p.vy; p.vy += 0.1; p.life -= 0.015;
              ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
              ctx.fillStyle = p.color; ctx.globalAlpha = p.life; ctx.fill();
            });
            if (Math.random() < 0.05) {
              const x = Math.random() * canvas.width;
              const y = Math.random() * canvas.height / 2;
              for(let i=0; i<30; i++) particles.push({ x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, life: 1, color: `hsl(${Math.random()*360}, 70%, 50%)` });
            }
            animationId = requestAnimationFrame(loop);
          };
          loop();
          return () => { window.removeEventListener('resize', resize); cancelAnimationFrame(animationId); };
        }, []);
        return <canvas ref={canvasRef} className="fixed inset-0 pointer-events-none z-50" />;
      };

      const GameScreen = ({ sentences, onComplete, onBack }) => {
        const [index, setIndex] = useState(0);
        const [playerWords, setPlayerWords] = useState([]);
        const [shuffled, setShuffled] = useState([]);
        const [wrongId, setWrongId] = useState(null);
        const [isDone, setIsDone] = useState(false);
        const [highlightIdx, setHighlightIdx] = useState(-1);
        const [voices, setVoices] = useState([]);
        const [selectedVoiceURI, setSelectedVoiceURI] = useState(null);
        const [score, setScore] = useState(0);
        
        const current = sentences[index];
        const targetWords = useMemo(() => current.en.replace(/[.!?]$/, '').split(/\s+/), [current]);

        const getVoices = useCallback(() => {
          const v = window.speechSynthesis.getVoices();
          const englishVoices = v.filter(voice => voice.lang.startsWith('en'));
          setVoices(englishVoices);
          if (englishVoices.length > 0 && !selectedVoiceURI) {
            const defaultVoice = englishVoices.find(v => v.name.includes('US')) || englishVoices[0];
            setSelectedVoiceURI(defaultVoice.voiceURI);
          }
        }, [selectedVoiceURI]);

        useEffect(() => {
          getVoices();
          window.speechSynthesis.onvoiceschanged = getVoices;
        }, [getVoices]);

        const speak = useCallback((text, options = {}) => {
          window.speechSynthesis.cancel();
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = 'en-US';
          utterance.rate = 0.85;
          
          const voice = voices.find(v => v.voiceURI === selectedVoiceURI);
          if (voice) utterance.voice = voice;

          if (options.onBoundary) {
            utterance.onboundary = (e) => {
              if (e.name === 'word') {
                const words = text.split(/\s+/);
                let charCount = 0;
                for (let i = 0; i < words.length; i++) {
                  if (e.charIndex <= charCount) {
                    options.onBoundary(i);
                    break;
                  }
                  charCount += words[i].length + 1;
                }
              }
            };
          }
          window.speechSynthesis.speak(utterance);
        }, [voices, selectedVoiceURI]);

        useEffect(() => {
          setIsDone(false);
          setPlayerWords([]);
          setHighlightIdx(-1);
          const wordsWithIds = targetWords.map((w, i) => ({ word: String(w), id: `word-${i}` }));
          setShuffled([...wordsWithIds].sort(() => Math.random() - 0.5));
          speak(current.en);
        }, [index, targetWords, current.en, speak]);

        const handleWordClick = (wordObj) => {
          if (isDone) return;
          const nextIdx = playerWords.length;
          if (wordObj.word === targetWords[nextIdx]) {
            const nextPlayerWords = [...playerWords, wordObj.word];
            setPlayerWords(nextPlayerWords);
            setShuffled(prev => {
              const newArr = [...prev];
              const idx = newArr.findIndex(s => s.id === wordObj.id);
              if (idx > -1) newArr[idx] = { ...newArr[idx], used: true };
              return newArr;
            });
            
            if (nextPlayerWords.length === targetWords.length) {
              setIsDone(true);
              setScore(prev => prev + 10);
              speak(current.en, { 
                onBoundary: (i) => setHighlightIdx(i)
              });
              setTimeout(() => {
                if (index + 1 < sentences.length) setIndex(index + 1);
                else onComplete();
              }, 2200);
            }
          } else {
            setWrongId(wordObj.id);
            setTimeout(() => setWrongId(null), 400);
          }
        };

        const pastelColors = [
          'bg-sky-200 border-sky-300 text-sky-800',
          'bg-emerald-200 border-emerald-300 text-emerald-800',
          'bg-rose-200 border-rose-300 text-rose-800',
          'bg-amber-200 border-amber-300 text-amber-800',
          'bg-violet-200 border-violet-300 text-violet-800',
          'bg-cyan-200 border-cyan-300 text-cyan-800'
        ];

        return (
          <div className="flex flex-col items-center gap-4 w-full fade-in">
            {/* Sentence Header */}
            <div className="w-full bg-purple-50 border-2 border-purple-100 p-4 rounded-2xl text-center">
              <p className="text-xl sm:text-2xl font-bold text-purple-900">‚Äú{current.vi}‚Äù</p>
            </div>

            {/* Answer Area (Slots) */}
            <div className="flex flex-wrap justify-center gap-3 min-h-[120px] w-full p-6 bg-slate-50 border-2 border-dashed border-slate-200 rounded-3xl items-center shadow-inner">
              {targetWords.map((_, i) => (
                <div key={i} className={`min-w-[75px] h-[55px] sm:min-w-[90px] sm:h-[65px] flex items-center justify-center rounded-2xl border-2 transition-all duration-300 ${playerWords[i] ? (isDone && highlightIdx === i ? 'bg-yellow-300 border-yellow-400 text-black scale-105 shadow-md' : 'bg-white border-slate-300 text-slate-800 shadow-sm') : 'bg-slate-200/50 border-slate-200 text-transparent'}`}>
                  <span className="text-xl sm:text-2xl font-bold">{playerWords[i] || ''}</span>
                </div>
              ))}
            </div>

            {/* Shuffled Word Buttons */}
            <div className="flex flex-wrap justify-center gap-3 mt-4 mb-6">
              {shuffled.map((obj, i) => (
                <button
                  key={obj.id}
                  onClick={() => handleWordClick(obj)}
                  disabled={obj.used}
                  className={`word-btn px-6 py-3 sm:px-8 sm:py-4 text-xl sm:text-2xl font-bold rounded-2xl border-b-4 transition-all ${obj.used ? 'opacity-0 pointer-events-none' : 'opacity-100'} ${wrongId === obj.id ? 'bg-red-100 border-red-500 text-red-600 animate-shake' : `${pastelColors[i % pastelColors.length]} hover:-translate-y-1 shadow-md active:border-b-0`}`}
                >
                  {obj.word}
                </button>
              ))}
            </div>

            {/* Control Bar */}
            <div className="flex flex-wrap items-center justify-center gap-4 w-full">
              <button onClick={() => speak(current.en)} className="px-6 py-3 bg-indigo-500 text-white font-bold rounded-2xl shadow-lg hover:bg-indigo-600 active:scale-95 transition-all flex items-center gap-2">
                Nghe l·∫°i <span className="text-lg">üîä</span>
              </button>
              
              <select 
                className="bg-white border-2 border-slate-200 rounded-xl px-4 py-3 font-bold text-slate-700 outline-none focus:border-indigo-400 transition-all max-w-[200px] sm:max-w-none"
                value={selectedVoiceURI || ''}
                onChange={(e) => setSelectedVoiceURI(e.target.value)}
              >
                {voices.map(v => (
                  <option key={v.voiceURI} value={v.voiceURI}>{v.name}</option>
                ))}
              </select>

              <button onClick={onBack} className="px-6 py-3 bg-slate-100 text-slate-600 font-bold rounded-2xl hover:bg-slate-200 transition-all">
                ƒê·ªïi ch·ªß ƒë·ªÅ
              </button>
            </div>

            {/* Score & Progress Pill */}
            <div className="mt-6 bg-slate-100 px-6 py-2 rounded-full border border-slate-200">
              <p className="text-sm sm:text-base font-bold text-slate-600">
                ƒêi·ªÉm: <span className="text-indigo-600">{score}</span> | Ti·∫øn tr√¨nh: <span className="text-indigo-600">{index + 1}/{sentences.length}</span>
              </p>
            </div>
          </div>
        );
      };

      const App = () => {
        const [view, setView] = useState('start');
        const [name, setName] = useState('');
        const [topic, setTopic] = useState('');

        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="w-full max-w-4xl bg-white rounded-[2.5rem] shadow-2xl p-6 sm:p-12 border-4 border-white">
              <header className="text-center mb-10">
                <h1 className="text-4xl md:text-5xl font-black text-indigo-700 tracking-tight">NG·ªÆ PH√ÅP L·ªöP 7</h1>
                <p className="text-blue-400 font-extrabold uppercase tracking-widest mt-2 text-sm sm:text-base">Gerund & Infinitive Mastery</p>
              </header>

              {view === 'start' && (
                <div className="flex flex-col items-center gap-6 fade-in">
                  <input
                    type="text"
                    placeholder="T√™n c·ªßa b·∫°n l√† g√¨?"
                    className="w-full max-w-sm p-5 text-xl text-center rounded-2xl border-4 border-indigo-50 focus:border-indigo-200 outline-none transition-all font-bold shadow-inner"
                    value={name}
                    onChange={(e) => setName(e.target.value)}
                  />
                  <button
                    disabled={!name.trim()}
                    onClick={() => setView('menu')}
                    className="w-full max-w-sm p-5 text-xl font-black text-white bg-indigo-500 rounded-3xl shadow-xl hover:bg-indigo-600 hover:scale-105 active:scale-95 transition-all disabled:opacity-50"
                  >
                    B·∫ÆT ƒê·∫¶U H·ªåC üöÄ
                  </button>
                </div>
              )}

              {view === 'menu' && (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 fade-in">
                  {Object.keys(topics).map((t, i) => (
                    <button
                      key={t}
                      onClick={() => { setTopic(t); setView('game'); }}
                      className={`p-8 text-lg sm:text-xl font-bold text-white rounded-[2rem] shadow-lg hover:-translate-y-1 active:scale-95 transition-all bg-gradient-to-br ${['from-sky-400 to-blue-500', 'from-emerald-400 to-teal-500', 'from-violet-400 to-purple-500', 'from-orange-400 to-rose-500', 'from-cyan-400 to-indigo-500'][i % 5]}`}
                    >
                      {t}
                    </button>
                  ))}
                </div>
              )}

              {view === 'game' && (
                <GameScreen 
                  sentences={topics[topic]} 
                  onComplete={() => setView('congrats')} 
                  onBack={() => setView('menu')} 
                />
              )}

              {view === 'congrats' && (
                <div className="text-center fade-in py-10">
                  <Fireworks />
                  <h2 className="text-5xl font-black text-emerald-500 mb-4">XU·∫§T S·∫ÆC! üéâ</h2>
                  <p className="text-2xl font-bold text-slate-700 mb-8">Ch√∫c m·ª´ng <span className="text-indigo-600">{name}</span>!</p>
                  <div className="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onClick={() => setView('menu')} className="px-10 py-4 bg-indigo-500 text-white text-xl font-bold rounded-2xl shadow-xl hover:bg-indigo-600 transition-all">
                      Ti·∫øp t·ª•c h·ªçc
                    </button>
                    <button onClick={() => setView('start')} className="px-10 py-4 bg-slate-100 text-slate-600 text-xl font-bold rounded-2xl hover:bg-slate-200 transition-all">
                      Tho√°t
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
